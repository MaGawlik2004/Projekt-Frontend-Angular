import { Injectable, signal, computed, WritableSignal, Signal } from '@angular/core';

// Eksportujemy typy, aby móc z nich korzystać w komponentach
export type TranslationValue = string | Record<string, string>;
export type TranslationSection = Record<string, TranslationValue>;
export type TranslationLanguage = Record<string, TranslationSection>;

@Injectable({ providedIn: 'root' })
export class LanguageService {
  private readonly translations: Record<string, TranslationLanguage> = {
    pl: {
      common: {
        back: 'Wróć',
        cancel: 'Anuluj',
        next: 'Dalej',
        yes: 'Tak',
        no: 'Nie',
        save: 'Zapisz',
        of: 'z',
      },
      admin: {
        title: 'Panel Administratora',
        addNewDoctor: 'Dodaj Nowego Lekarza',
        tableEmail: 'E-mail Lekarza',
        tableActions: 'Akcja',
        btnDetails: 'Szczegóły & Kalendarz',
        emptyState: 'Brak zarejestrowanych lekarzy w systemie.',
        page: 'Strona',
        modalTitle: 'Nowy profil lekarza',
        labelName: 'Imię i Nazwisko',
        labelEmail: 'Adres E-mail',
        labelPass: 'Hasło tymczasowe',
        btnSave: 'Zapisz Lekarza',
        placeholderName: 'np. Jan Kowalski',
        placeholderEmail: 'lekarz@klinika.pl',
        placeholderPass: 'Minimum 8 znaków',
      },
      doctorDetail: {
        management: 'Zarządzanie',
        active: 'Aktywny',
        blocked: 'Zablokowany',
        genSchedule: 'Generuj Grafik',
        resetPass: 'Zmień Hasło',
        changeStatus: 'Zmień Status',
        genTitle: 'Generator grafiku',
        startWork: 'Początek pracy',
        endWork: 'Koniec pracy',
        visitDuration: 'Czas trwania wizyty',
        breaks: 'Przerwy',
        addBreak: 'Dodaj przerwę',
        btnGenerate: 'Generuj Grafik',
        confirmStatus: 'Zmienić status?',
      },
      auth: {
        loginTitle: 'Logowanie',
        loginSubtitle: 'Witaj ponownie w naszej klinice',
        emailPlaceholder: 'Email',
        passwordPlaceholder: 'Hasło',
        btnLogin: 'Zaloguj się',
        noAccount: 'Nie masz jeszcze konta?',
        registerNow: 'Zarejestruj się teraz',
        loginError: 'Błąd logowania: ',
      },
      register: {
        title: 'Załóż konto',
        subtitle: 'Wypełnij formularz, aby dołączyć do pacjentów',
        labelName: 'Imię i Nazwisko',
        nameError: 'Imię i nazwisko są wymagane',
        labelEmail: 'Adres E-mail',
        emailError: 'Wprowadź poprawny adres e-mail',
        labelPass: 'Hasło',
        passError: 'Hasło musi mieć min. 8 znaków',
        btnSubmit: 'Zarejestruj się',
        processing: 'Przetwarzanie...',
        hasAccount: 'Masz już konto?',
        loginNow: 'Zaloguj się teraz',
        successAlert: 'Konto zostało utworzone. Możesz się zalogować.',
        defaultError: 'Wystąpił błąd podczas rejestracji',
      },
      doctorPanel: {
        brand: 'Panel Lekarza',
        mySchedule: 'Mój Grafik',
        patients: 'Pacjenci',
      },
      doctorSchedule: {
        title: 'Mój grafik',
        notBookedAlert: 'Wizyta nie jest zajęta',
      },
      visitDetail: {
        backToSchedule: 'Grafik',
        status: 'Status',
        reasonTitle: 'Powód dzisiejszej wizyty',
        patientNotes: 'Notatki pacjenta:',
        historyTitle: 'Historia leczenia',
        emptyHistory: 'Brak poprzednich wpisów medycznych.',
        treatment: 'Leczenie:',
        recommendations: 'Zalecenia:',
        examCard: 'Karta Badania Lekarskiego',
        diagnosisLabel: 'Rozpoznanie / Diagnoza*',
        diagnosisPlaceholder: 'Wpisz wynik badania i diagnozę...',
        treatmentNotesLabel: 'Przebieg leczenia i notatki z wizyty',
        treatmentNotesPlaceholder: 'Opisz zastosowane metody leczenia...',
        recommendationsLabel: 'Zalecenia dla pacjenta (rozdzielone przecinkami)',
        recommendationsPlaceholder: 'np. Leki rano i wieczorem, Kontrola za tydzień',
        btnFinish: 'Zatwierdź i zakończ wizytę',
        btnAlreadyFinished: 'Wizyta już zakończona',
        successAlert: 'Wizyta została zakończona i zapisana',
        loading: 'Ładowanie danych wizyty...',
      },
      booking: {
        backToList: 'Wróć do listy lekarzy',
        title: 'Kalendarz wizyt',
        subtitle: 'Wybierz preferowaną godzinę spośród dostępnych terminów.',
        modalTitle: 'Potwierdź rezerwację',
        dateLabel: 'Data:',
        timeLabel: 'Godzina:',
        reasonLabel: 'Powód wizyty* (min. 5 znaków)',
        reasonPlaceholder: 'Opisz krótko swój problem medyczny...',
        prevTreatment: 'Czy to kolejna wizyta w tej sprawie?',
        notesLabel: 'Dodatkowe uwagi dla lekarza',
        notesPlaceholder: 'Opcjonalne informacje...',
        btnConfirm: 'Zarezerwuj teraz',
        loginRequired: 'Musisz się zalogować, aby zarezerwować termin.',
        reasonTooShort: 'Powód wizyty musi mieć co najmniej 5 znaków.',
        success: 'Wizyta zarezerwowana pomyślnie!',
        error: 'Błąd: ',
      },
      doctorList: {
        title: 'Nasi specjaliści',
        subtitle: 'Wybierz lekarza, aby umówić wizytę',
        specialty: 'Internista',
        nextAvailable: 'Najbliższy wolny termin:',
        noTerms: 'Brak wolnych terminów',
        btnBook: 'Umów wizytę',
        btnLoginToBook: 'Login to book',
      },
      myAppointments: {
        upcomingTitle: 'Nadchodzące wizyty',
        completedTitle: 'Zakończone wizyty',
        visitWithDoctor: 'Wizyta u lekarza',
        visitCompleted: 'Wizyta zakończona',
        reason: 'Powód:',
        btnCancel: 'Odwołaj',
        btnShowDetails: 'Szczegóły',
        btnHideDetails: 'Ukryj',
        emptyUpcoming: 'Nie masz zaplanowanych wizyt.',
        emptyHistory: 'Historia wizyt jest pusta.',
        diagnosis: 'Rozpoznanie',
        recommendations: 'Zalecenia',
        treatmentNotes: 'Notatki z leczenia',
        sidebarTitle: 'Twoja Kartoteka',
        sidebarSubtitle: 'Kliknij wpis, aby go rozwinąć',
        emptySidebar: 'Twoja kartoteka jest pusta.',
        treatmentLabel: 'Leczenie:',
        dateLabel: 'Data:',
        cancelConfirm: 'Czy na pewno chcesz odwołać tę wizytę?',
        cancelSuccess: 'Wizyta została odwołana.',
        cancelError: 'Błąd: ',
      },
      userPanel: {
        logged: 'Zalogowany',
        guest: 'Gość',
        yourAccount: 'Twoje Konto',
        browsingMode: 'Tryb Przeglądania',
        doctorList: 'Lista Lekarzy',
        myAppointments: 'Moje wizyty',
        loginToBook: 'Zaloguj się, aby rezerwować terminy',
        btnLogin: 'Zaloguj się',
      },
      nav: {
        themeLight: 'Tryb jasny',
        themeDark: 'Tryb ciemny',
        register: 'Zarejestruj się',
        login: 'Zaloguj się',
        logout: 'Wyloguj się',
      },
      notFound: {
        title: '404',
        subtitle: 'Strona nie została znaleziona',
        description:
          'Przepraszamy, ale strona, której szukasz, nie istnieje lub została przeniesiona.',
        btnBack: 'Wróć do strony głównej',
      },
      notifications: {
        fetchDoctorsError: 'Nie udało się pobrać listy lekarzy.',
        createDoctorSuccess: 'Lekarz został pomyślnie dodany!',
        createDoctorError: 'Błąd: Nie udało się dodać lekarza',
        fillTimeframes: 'Proszę wypełnić ramy czasowe grafiku.',
        scheduleSuccess: 'Grafik został wygenerowany pomyślnie!',
        updateApptSuccess: 'Termin został zaktualizowany.',
        deleteApptSuccess: 'Termin został usunięty.',
        passwordSuccess: 'Hasło zostało zmienione pomyślnie.',
        statusSuccess: 'Status lekarza został zmieniony.',
        confirmDeleteAppt: 'Czy na pewno chcesz usunąć ten termin?',
        errorDefault: 'Wystąpił nieoczekiwany błąd',
        loginSuccess: 'Zalogowano pomyślnie!',
        registerSuccess: 'Konto utworzone! Możesz się teraz zalogować.',
        fetchScheduleError: 'Nie udało się pobrać grafiku.',
        visitSaveSuccess: 'Wizyta została pomyślnie zakończona i zapisana.',
        visitSaveError: 'Wystąpił błąd podczas zapisywania karty wizyty.',
        slotNotBooked: 'Ten termin nie został jeszcze zarezerwowany przez pacjenta.',
        loadAppointmentsError: 'Nie udało się pobrać terminów lekarza.',
        loadHistoryError: 'Nie udało się pobrać historii medycznej.',
        bookingSuccess: 'Wizyta została pomyślnie zarezerwowana!',
        bookingError: 'Nie udało się zarezerwować wizyty.',
        cancelSuccess: 'Wizyta została odwołana.',
        cancelError: 'Wystąpił błąd podczas odwoływania wizyty.',
      },
    },
    en: {
      common: {
        back: 'Back',
        cancel: 'Cancel',
        next: 'Next',
        yes: 'Yes',
        no: 'No',
        save: 'Save',
        of: 'of',
      },
      admin: {
        title: 'Admin Panel',
        addNewDoctor: 'Add New Doctor',
        tableEmail: 'Doctor Email',
        tableActions: 'Action',
        btnDetails: 'Details & Calendar',
        emptyState: 'No doctors registered in the system.',
        page: 'Page',
        modalTitle: 'New Doctor Profile',
        labelName: 'Full Name',
        labelEmail: 'Email Address',
        labelPass: 'Temporary Password',
        btnSave: 'Save Doctor',
        placeholderName: 'e.g. John Doe',
        placeholderEmail: 'doctor@clinic.com',
        placeholderPass: 'Min. 8 characters',
      },
      doctorDetail: {
        management: 'Management',
        active: 'Active',
        blocked: 'Blocked',
        genSchedule: 'Generate Schedule',
        resetPass: 'Reset Password',
        changeStatus: 'Change Status',
        genTitle: 'Schedule Generator',
        startWork: 'Work Start',
        endWork: 'Work End',
        visitDuration: 'Visit Duration',
        breaks: 'Breaks',
        addBreak: 'Add break',
        btnGenerate: 'Generate Schedule',
        confirmStatus: 'Change status?',
      },
      auth: {
        loginTitle: 'Login',
        loginSubtitle: 'Welcome back to our clinic',
        emailPlaceholder: 'Email',
        passwordPlaceholder: 'Password',
        btnLogin: 'Login',
        noAccount: "Don't have an account?",
        registerNow: 'Register now',
        loginError: 'Login error: ',
      },
      register: {
        title: 'Create Account',
        subtitle: 'Fill out the form to join as a patient',
        labelName: 'Full Name',
        nameError: 'Full name is required',
        labelEmail: 'Email Address',
        emailError: 'Enter a valid email address',
        labelPass: 'Password',
        passError: 'Password must be at least 8 characters',
        btnSubmit: 'Sign Up',
        processing: 'Processing...',
        hasAccount: 'Already have an account?',
        loginNow: 'Login now',
        successAlert: 'Account created. You can now log in.',
        defaultError: 'An error occurred during registration',
      },
      doctorPanel: {
        brand: 'Doctor Panel',
        mySchedule: 'My Schedule',
        patients: 'Patients',
      },
      doctorSchedule: {
        title: 'My schedule',
        notBookedAlert: 'This slot is not booked',
      },
      visitDetail: {
        backToSchedule: 'Schedule',
        status: 'Status',
        reasonTitle: "Reason for today's visit",
        patientNotes: 'Patient notes:',
        historyTitle: 'Medical History',
        emptyHistory: 'No previous medical records.',
        treatment: 'Treatment:',
        recommendations: 'Recommendations:',
        examCard: 'Medical Examination Card',
        diagnosisLabel: 'Diagnosis*',
        diagnosisPlaceholder: 'Enter test results and diagnosis...',
        treatmentNotesLabel: 'Treatment course and visit notes',
        treatmentNotesPlaceholder: 'Describe the applied treatment methods...',
        recommendationsLabel: 'Patient recommendations (comma separated)',
        recommendationsPlaceholder: 'e.g., Medicine morning and evening, Follow-up in a week',
        btnFinish: 'Confirm and finish visit',
        btnAlreadyFinished: 'Visit already completed',
        successAlert: 'Visit has been completed and saved',
        loading: 'Loading visit data...',
      },
      booking: {
        backToList: 'Back to doctors list',
        title: 'Appointment Calendar',
        subtitle: 'Choose your preferred time from the available slots.',
        modalTitle: 'Confirm Booking',
        dateLabel: 'Date:',
        timeLabel: 'Time:',
        reasonLabel: 'Reason for visit* (min. 5 chars)',
        reasonPlaceholder: 'Briefly describe your medical issue...',
        prevTreatment: 'Is this a follow-up visit for this matter?',
        notesLabel: 'Additional notes for the doctor',
        notesPlaceholder: 'Optional information...',
        btnConfirm: 'Book Now',
        loginRequired: 'You must be logged in to book an appointment.',
        reasonTooShort: 'Reason for visit must be at least 5 characters.',
        success: 'Appointment booked successfully!',
        error: 'Error: ',
      },
      doctorList: {
        title: 'Our Specialists',
        subtitle: 'Choose a doctor to schedule a visit',
        specialty: 'Internist',
        nextAvailable: 'Next available slot:',
        noTerms: 'No available slots',
        btnBook: 'Book visit',
        btnLoginToBook: 'Login to book',
      },
      myAppointments: {
        upcomingTitle: 'Upcoming Appointments',
        completedTitle: 'Past Appointments',
        visitWithDoctor: 'Doctor Visit',
        visitCompleted: 'Completed Visit',
        reason: 'Reason:',
        btnCancel: 'Cancel',
        btnShowDetails: 'Details',
        btnHideDetails: 'Hide',
        emptyUpcoming: 'You have no scheduled appointments.',
        emptyHistory: 'Visit history is empty.',
        diagnosis: 'Diagnosis',
        recommendations: 'Recommendations',
        treatmentNotes: 'Treatment Notes',
        sidebarTitle: 'Medical Record',
        sidebarSubtitle: 'Click an entry to expand',
        emptySidebar: 'Your medical record is empty.',
        treatmentLabel: 'Treatment:',
        dateLabel: 'Date:',
        cancelConfirm: 'Are you sure you want to cancel this appointment?',
        cancelSuccess: 'Appointment has been cancelled.',
        cancelError: 'Error: ',
      },
      userPanel: {
        logged: 'Logged in',
        guest: 'Guest',
        yourAccount: 'Your Account',
        browsingMode: 'Browsing Mode',
        doctorList: 'Doctor List',
        myAppointments: 'My Appointments',
        loginToBook: 'Log in to book appointments',
        btnLogin: 'Login',
      },
      nav: {
        themeLight: 'Light mode',
        themeDark: 'Dark mode',
        register: 'Register',
        login: 'Login',
        logout: 'Logout',
      },
      notFound: {
        title: '404',
        subtitle: 'Page Not Found',
        description: "Sorry, the page you're looking for doesn't exist or has been moved.",
        btnBack: 'Back to home page',
      },
      notifications: {
        fetchDoctorsError: 'Failed to fetch doctors list.',
        createDoctorSuccess: 'Doctor has been successfully added!',
        createDoctorError: 'Error: Failed to add doctor',
        fillTimeframes: 'Please fill in the schedule time frame.',
        scheduleSuccess: 'Schedule generated successfully!',
        updateApptSuccess: 'Appointment updated.',
        deleteApptSuccess: 'Appointment deleted.',
        passwordSuccess: 'Password changed successfully.',
        statusSuccess: 'Doctor status has been changed.',
        confirmDeleteAppt: 'Are you sure you want to delete this appointment?',
        errorDefault: 'An unexpected error occurred',
        loginSuccess: 'Login successful!',
        registerSuccess: 'Account created! You can now log in.',
        fetchScheduleError: 'Failed to fetch your schedule.',
        visitSaveSuccess: 'The visit has been successfully completed and saved.',
        visitSaveError: 'An error occurred while saving the visit card.',
        slotNotBooked: 'This slot has not been booked by a patient yet.',
        loadAppointmentsError: 'Failed to load doctor appointments.',
        loadHistoryError: 'Failed to load medical history.',
        bookingSuccess: 'Appointment booked successfully!',
        bookingError: 'Failed to book the appointment.',
        cancelSuccess: 'Appointment has been cancelled.',
        cancelError: 'Error occurred while cancelling the appointment.',
      },
    },
  };

  public currentLang: WritableSignal<string> = signal(localStorage.getItem('lang') || 'pl');

  public t: Signal<TranslationLanguage> = computed(() => this.translations[this.currentLang()]);

  public setLanguage(lang: string): void {
    this.currentLang.set(lang);
    localStorage.setItem('lang', lang);
  }

  public translate(pl: string, en: string): string {
    return this.currentLang() === 'pl' ? pl : en;
  }
}
